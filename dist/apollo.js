var apollo=function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);var i=class{constructor(e){this.post=e.post}login(e,t){return this.post.send("/auth/loginwithemail",{email:e,password:t})}async register(e,t,s,i){try{var r=await this.post.send("/auth/register",{email:e,password:t,displayName:s,phone:i});return"PHONE-CODE-SENT"===r.code?{code:r.code,message:r.message,confirm:e=>this.post.send("/auth/register",{token:r.token,verificationCode:e})}:r}catch(e){throw e}}async updateProfile(e,t,s){try{var i=await this.post.send("/auth/updateProfile",{displayName:e,phone:s,displayPicture:t});return"PHONE-CODE-SENT"===i.code?{code:i.code,message:i.message,confirm:e=>this.post.send("/auth/updateProfile",{token:i.token,verificationCode:e})}:i}catch(e){throw e}}async forgotPassword(e){try{var t=await this.post.send("/auth/forgotPassword",{email:e});return"PHONE-CODE-SENT"===t.code?{code:t.code,message:t.message,confirm:(e,s)=>this.post.send("/auth/forgotPassword",{token:t.token,verificationCode:e,password:s})}:t}catch(e){throw e}}async changePassword(e){try{var t=await this.post.send("/auth/changePassword",{password:e});return"PHONE-CODE-SENT"===t.code?{code:t.code,message:t.message,confirm:e=>this.post.send("/auth/changePassword",{token:t.token,verificationCode:e})}:t}catch(e){throw e}}isAuthenticated(){return this.post.send("/auth/protectedpage",{})}ping(){return this.post.send("/auth/ping",{})}logout(){return this.post.send("/auth/logout",{})}};var r=class{constructor(e){this.post=e.post}uploadFile(e,t){var s=new FormData;return s.append("file",e),s.append("filename",t),this.post.send("/storage/uploadFile",s,"file")}getFileUrl(e){return this.post.send("/storage/getFileUrl",{filename:e})}};var n=class{constructor(e){this.post=e.post,this.duplex=e.duplex}pairDevice(e){return this.post.send("/devices/pairDevice",{deviceID:e})}unpairDevice(e){return this.duplex.send({header:{task:"unpairDevice"},payload:{deviceID:e}})}getUserDevices(){return this.duplex.send({header:{task:"getUserDevices"}})}getOnlineDevicesCount(){return this.duplex.send({header:{task:"getOnlineDevicesCount"}})}getDeviceSummary(e){return this.duplex.send({header:{task:"getDeviceSummary"},payload:{deviceID:e}})}getDeviceParms(e){return this.duplex.send({header:{task:"getDeviceParms"},payload:{deviceID:e}})}setDeviceSummary(e,t){return this.duplex.send({header:{task:"setDeviceSummary"},payload:{deviceID:e,summary:t}})}setDeviceParms(e,t){return this.duplex.send({header:{task:"setDeviceParms"},payload:{deviceID:e,parms:t}})}getDeviceDetails(e){return this.duplex.send({header:{task:"getDeviceDetails"},payload:{deviceID:e}})}setDeviceName(e,t){return this.duplex.send({header:{task:"setDeviceName"},payload:{deviceID:e,deviceName:t}})}getDeviceStatus(e){return this.duplex.send({header:{task:"getDeviceStatus"},payload:{deviceID:e}})}onDeviceSummaryUpdated(e,t){return this.duplex.subscribeTopic("setDeviceSummary",t,e)}onDeviceParmUpdated(e,t){return this.duplex.subscribeTopic("setDeviceParms",t,e)}onDeviceNameUpdated(e,t){return this.duplex.subscribeTopic("setDeviceName",t,e)}onDeviceStatusUpdated(e,t){return this.duplex.subscribeTopic("setDeviceStatus",t,e)}onDevicesListUpdated(e){return this.duplex.subscribeTopic("setDevicesList",e)}};var a=class{constructor(e){this.config=e}send(e,t,s){const i=this.config.url+e+"?apiKey="+this.config.apiKey;var r={};return"file"!==s&&(t=JSON.stringify(t),r={"Content-Type":"application/json"}),new Promise((e,s)=>{fetch(i,{method:"POST",mode:"cors",body:t,credentials:"include",SameSite:"none",headers:r}).then(e=>e.json()).then(t=>{e(t)},e=>{s({code:"ERR-CONNECTION-REFUSED",message:"Failed to connect to the server. Check internet connection."})})})}};var o=class{constructor(e){this.node=e.node+"?apiKey="+e.apiKey,this.eventQueue={},this.subscriptions={},this.status="DISCONNECTED",this.errResponse={code:"ERR-CONNECTION-REFUSED",message:"Apollo is not connected to server. Check internet connection."},this.otherEvents=["setDevicesList"],this.deviceEvents=["setDeviceSummary","setDeviceParms","setDeviceName","setDeviceStatus"]}async init(e){try{switch((await e.ping()).code){case"AUTH-AUTHORIZED":this.ws=new WebSocket(this.node,"node");break;case"AUTH-UNAUTHORIZED":return this.reconnect(e),void(this.errResponse={code:"AUTH-UNAUTHORIZED",message:"You are not authenticated to the server."})}}catch(t){return this.reconnect(e),void(this.errResponse={code:"ERR-CONNECTION-REFUSED",message:"Apollo is not connected to server. Check internet connection."})}this.ws.onopen=()=>{this.status="CONNECTED",this.ping=setInterval(()=>{this.ws.send(JSON.stringify({header:{id:"ping",task:"ping"},payload:{}}))},25e3)},this.ws.onclose=()=>{this.status="DISCONNECTED",clearInterval(this.ping),this.reconnect(e),this.errResponse={code:"ERR-CONNECTION-REFUSED",message:"Apollo is not connected to server. Check internet connection."}},this.ws.onmessage=e=>{var t=JSON.parse(e.data);"update"===t.header.task?this.deviceEvents.includes(t.payload.event)?this.subscriptions[`${t.payload.event}/${t.payload.deviceID}`]&&this.subscriptions[`${t.payload.event}/${t.payload.deviceID}`](t.payload.update):this.subscriptions[t.payload.event]&&this.subscriptions[t.payload.event](t.payload.update):this.eventQueue[t.header.id]&&(this.eventQueue[t.header.id].resolve(t.payload),delete this.eventQueue[t.header.id])}}reconnect(e){setTimeout(()=>{this.init(e)},5e3)}send(e){return new Promise((t,s)=>{if("CONNECTED"===this.status){var i=Date.now();e.header.id=i,this.eventQueue[i]={resolve:t,reject:s},this.ws.send(JSON.stringify(e))}else s(this.errResponse)})}async subscribeTopic(e,t,s){if(this.deviceEvents.includes(e)||this.otherEvents.includes(e))if(!this.deviceEvents.includes(e)||s){var i={header:{task:"subscribeTopic"},payload:{event:e,deviceID:s}};try{var r=await this.send(i);return this.deviceEvents.includes(e)?this.subscriptions[`${e}/${s}`]=t:this.subscriptions[e]=t,{...r,clear:()=>{var t={header:{task:"unsubscribeTopic"},payload:{event:e,deviceID:s}};return this.send(t)}}}catch(e){throw e}}else t({code:"DATA-INVALID",message:"Device ID is required."});else t({code:"TOPIC-INVALID",message:"The specified topic seems invalid."})}};s.d(t,"init",(function(){return d}));const c={url:"https://api.grandeur.tech",node:"wss://api.grandeur.tech"};function d(e){const t={...c,apiKey:e},s=new a(t),d=new o(t),u={post:s,duplex:d};return d.init(new i(u)),{isConnected:()=>"CONNECTED"===u.duplex.status,auth:()=>new i(u),storage:()=>new r(u),device:()=>new n(u)}}}]);